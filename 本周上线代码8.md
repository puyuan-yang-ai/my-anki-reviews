我需要分析当前的代码结构和新的数据格式，然后提出修改方案。

Read file: model_evaluator.py

Read file: model_evaluator.py

Read file: model_evaluator.py

Ran tool
根据代码分析，需要修改以下几个部分来适应新的数据格式：

1. 更新数据收集部分，添加基线模型路径
2. 修改 `ModelEvaluator` 类，使其直接使用基线模型而不是创建新的
3. 更新评估流程

以下是具体的修改方案：

```python
# 1. 在数据收集部分添加基线模型路径
for gen_entry in gen_data:
    prompt_id = gen_entry["prompt_id"]
    if prompt_id in evaluation_pairs:
        if "path_to_gen_code" in gen_entry:
            evaluation_pairs[prompt_id]["gen_path"] = gen_entry["path_to_gen_code"]
        # 添加基线模型路径
        if "path_to_gen_code_baseline" in gen_entry:
            evaluation_pairs[prompt_id]["baseline_path"] = gen_entry["path_to_gen_code_baseline"]

# 2. 修改 ModelEvaluator 类，接受基线模型路径
class ModelEvaluator:
    """Model Evaluator"""

    def __init__(self, gen_file: str, baseline_file: str = None, batch_size: int = 4, num_samples: int = 32):
        self.gen_loader = ModelLoader(gen_file)
        self.baseline_file = baseline_file

        # Set evaluation parameters
        self.args = argparse.Namespace()
        self.args.batch_size = batch_size
        self.args.steps = 50
        self.args.num_samples = num_samples

        # Load CLIP model
        self.clip_model, _, self.clip_preprocess = open_clip.create_model_and_transforms(
            'ViT-g-14', pretrained='laion2b_s34b_b88k')
        self.clip_model.cuda()
        self.tokenizer = open_clip.get_tokenizer('ViT-g-14')

        # Load test data
        dataset = load_dataset("phiyodr/coco2017")
        self.prompts = [sample['captions'][0] for sample in dataset['validation']][:num_samples]

    def evaluate(self) -> Dict[str, Any]:
        """Evaluate baseline and accelerated models"""
        # 获取基线模型或创建新的
        if self.baseline_file:
            print(f"Loading baseline model from: {self.baseline_file}")
            baseline_loader = ModelLoader(self.baseline_file)
            base_pipe = baseline_loader.pipe
        else:
            # 如果没有提供基线模型，则创建一个
            print("Creating baseline model...")
            base_pipe = create_base_pipeline(self.gen_loader.config)
        
        base_time, base_score = evaluation(
            self.args,
            self.prompts,
            base_pipe,
            self.clip_model,
            self.clip_preprocess,
            self.tokenizer
        )

        print("Evaluating accelerated model...")
        acc_time, acc_score = evaluation(
            self.args,
            self.prompts,
            self.gen_loader.pipe,  # 加速模型
            self.clip_model,
            self.clip_preprocess,
            self.tokenizer
        )

        # Calculate speedup and quality loss
        speedup = base_time / acc_time
        score_loss = (base_score - acc_score) / base_score

        return {
            "Model Configuration": {
                "pipeline_name": self.gen_loader.config.pipeline_name,
                "model_id": self.gen_loader.config.model_id,
                "scheduler_name": self.gen_loader.config.scheduler_name,
                "num_inference_steps": self.gen_loader.config.num_inference_steps,
            },
            "Acceleration Methods": self.gen_loader.config.acceleration_methods,
            "Performance Evaluation": {
                "baseline_time": f"{base_time:.4f}s",
                "accelerated_time": f"{acc_time:.4f}s",
                "baseline_score": f"{base_score:.2f}",
                "accelerated_score": f"{acc_score:.2f}",
                "speedup": f"{speedup:.2f}x",
                "relative_quality_loss": f"{score_loss * 100:.2f}%"
            }
        }

# 3. 在主流程中，使用基线模型路径
# 如果配置匹配，进行性能评估
if is_same_config:
    print("Base configuration matched, starting performance evaluation...")
    
    # 获取基线模型路径
    baseline_path = data.get("baseline_path", None)
    if baseline_path:
        print(f"Using provided baseline model: {baseline_path}")
        evaluator = ModelEvaluator(gen_path, baseline_path)
    else:
        evaluator = ModelEvaluator(gen_path)
    
    results = evaluator.evaluate()
    print_evaluation_results(results)
    
    # 其余代码保持不变...
```

主要修改总结：

1. 在数据收集阶段，添加了对 `path_to_gen_code_baseline` 字段的处理
2. 修改了 `ModelEvaluator` 类，使其接受基线模型路径参数
3. 在 `evaluate` 方法中，优先使用提供的基线模型，如果没有则创建新的
4. 在主流程中，传递基线模型路径给 `ModelEvaluator`

这些修改使评估器能够直接使用指定的基线模型，而不需要从加速模型中提取或创建新的，从而适应新的数据格式。
