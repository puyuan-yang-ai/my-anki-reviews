让我先看一下 `virtual_interview.py` 的实现，以便更好理解参考接口的具体逻辑。

[1 tool called]

好的，我现在完全理解了。让我来回答你的三个问题：

---

## 1. 逻辑复述 & 核心目标

### 我的理解

**深度简历优化 - 对话接口 (converse)** 是一个**多轮对话式信息挖掘服务**：

- **目标用户**：只有基础个人信息（姓名、学历、专业等），但**没有完整简历**的学生
- **核心目的**：不是做求职面试评估，而是通过类似"职业培训师/长辈聊天"的方式，**挖掘学生的个人优点和潜力**，为简历收集素材
- **最终结果**：对话结束后不生成评估报告，而是交给 `generate` 接口生成一份完整简历

### 参考实现对比

参考 `virturlInterview` 接口的实现，我理解 `converse` 接口需要实现类似的模式：

| 特性 | virturlInterview（求职面试） | converse（深度简历挖掘） |
|------|-------------------------------|---------------------------|
| 响应方式 | 流式 (StreamingResponse) | 应该也是流式？ |
| 首次调用 | 生成面试计划 | 生成对话/挖掘计划 |
| 对话策略 | 评估候选人能力 | 挖掘优点和潜力 |
| 结束标志 | AI 判断面试结束 | AI 判断信息收集完毕 |
| 最终产出 | 生成评估报告 | **不生成报告**，直接调用 generate 生成简历 |

---

## 2. 功能点拆解

### 核心模块

1. **对话计划生成模块**
   - 首次调用时，根据 `user_profile`（学历、专业、求职期望）生成对话计划
   - 计划包含多个阶段的问题：个人介绍 → 专业看法 → 职业规划 → 案例分析等

2. **对话策略模块**
   - 根据当前对话历史和用户回答，决定下一步策略
   - 策略类型：追问细节 / 切换话题 / 结束对话

3. **对话执行模块**
   - 基于策略，生成具体的 AI 回复内容
   - 使用流式响应返回给前端

4. **意图/状态识别模块**
   - 判断当前对话状态：新问题 / 追问 / 确认状态 / 结束
   - 判断用户回复有效性（空回复、沉默检测）

5. **结束判断模块**
   - 判断信息是否收集完毕
   - 信号给前端：可以调用 `generate` 接口了

### 需要的 Prompt 文件

| Prompt 文件 | 用途 |
|-------------|------|
| `generate_plan_deep_resume.txt` | 根据用户档案生成对话挖掘计划 |
| `strategy_deep_resume.txt` | 对话策略生成（决定追问/换题/结束） |
| `executor_deep_resume.txt` | 执行层：生成具体的友善提问内容 |
| `judge_flow_deep_resume.txt` | 判断对话是否可以结束 |

### 数据流

```
┌────────────────────────────────────────────────────────────────┐
│  POST /resume/deep-optimization/converse                       │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  输入: user_profile + history + user_message                   │
│                           │                                    │
│                           ▼                                    │
│  ┌──────────────────────────────────────┐                      │
│  │ 首次调用?                             │                      │
│  │  YES → 生成对话计划 + 返回开场白       │                      │
│  │  NO  → 继续下面流程                   │                      │
│  └──────────────────────────────────────┘                      │
│                           │                                    │
│                           ▼                                    │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────────────┐   │
│  │ 策略层 LLM  │ → │ 执行层 LLM  │ → │ 流式返回 AI 回复     │   │
│  │ (决定追问/  │   │ (生成友善   │   │ StreamingResponse   │   │
│  │  换题/结束) │   │  的具体内容)│   │                     │   │
│  └─────────────┘   └─────────────┘   └─────────────────────┘   │
│                                               │                │
│                                               ▼                │
│                           ┌─────────────────────────────────┐  │
│                           │ 判断是否结束:                    │  │
│                           │  - 信息充足?                     │  │
│                           │  - 用户要求结束?                 │  │
│                           │  返回 over 信号                  │  │
│                           └─────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────┘
```

---

## 3. 我的疑问（需要澄清）

### 关于技术实现

1. **响应方式**：是否需要像 `virturlInterview` 一样使用流式响应 (StreamingResponse)？还是普通 JSON 响应即可？

2. **对话计划存储**：
   - `virturlInterview` 的 `interview_plan` 是存在内存中的，每次请求都是新实例
   - 深度简历的对话计划如何持久化？是前端传回来，还是后端需要维护状态？

3. **沉默检测**：是否需要类似 `virturlInterview` 的连续沉默检测（3 次无效回复强制结束）？

### 关于业务逻辑

4. **对话轮次**：是否有预设的最大对话轮次？大约多少轮合适（参考面试接口是 5-8 个问题）？

5. **问题类型**：文档提到"案例分析判断思维模式"，这类问题是否需要特殊处理（比如给出场景让学生分析）？

6. **结束触发**：
   - 谁来决定对话结束？AI 自动判断 / 用户主动点击"生成简历"？
   - 如果用户信息不充分就要求结束，是否给出提示？

7. **AI 角色定位**：文档说是"长辈或职业培训师"，语气应该是**温和鼓励型**还是**严谨专业型**？需要在 prompt 中明确。

---

请你针对以上疑问给我反馈，确认后我们就可以开始编写代码了！
